<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>股票预测分析平台</title>
  <link rel="stylesheet" href="src/assets/styles.css">
  <!-- 引入字体图标 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
  
  <!-- 添加预加载提示 -->
  <script>
    window.onload = function() {
      // 检查是否设置了API密钥
      setTimeout(function() {
        var apiInput = document.getElementById('api-key-input');
        if (apiInput) {
          var savedApiKey = localStorage.getItem('alphavantage_api_key');
          if (savedApiKey) {
            apiInput.value = savedApiKey;
            // 更新应用中的API密钥
            window.updateApiKey && window.updateApiKey(savedApiKey);
          } else {
            // 显示API密钥设置对话框
            document.getElementById('api-key-dialog').style.display = 'flex';
          }
        }
      }, 1000);
    };
    
    function saveApiKey() {
      var apiInput = document.getElementById('api-key-input');
      var apiKey = apiInput.value.trim();
      
      if (!apiKey) {
        alert('请输入有效的API密钥');
        return;
      }
      
      // 保存API密钥
      localStorage.setItem('alphavantage_api_key', apiKey);
      
      // 更新应用中的API密钥
      window.updateApiKey && window.updateApiKey(apiKey);
      
      alert('API密钥已保存！应用将使用此密钥获取股票数据。');
      
      // 隐藏对话框
      document.getElementById('api-key-dialog').style.display = 'none';
    }
  </script>
  
  <style>
    /* API密钥设置对话框样式 */
    #api-key-dialog {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      flex-direction: column;
    }
    
    .api-dialog-content {
      background-color: white;
      border-radius: 8px;
      padding: 20px;
      width: 400px;
      max-width: 90%;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    
    .api-dialog-title {
      font-size: 18px;
      font-weight: bold;
      margin-bottom: 16px;
      color: #333;
    }
    
    .api-dialog-body {
      margin-bottom: 20px;
    }
    
    .api-dialog-body p {
      margin-bottom: 10px;
      color: #666;
      line-height: 1.5;
    }
    
    .api-dialog-body input {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      margin-top: 5px;
      margin-bottom: 10px;
      box-sizing: border-box;
    }
    
    .api-dialog-footer {
      display: flex;
      justify-content: flex-end;
    }
    
    .api-dialog-footer button {
      padding: 8px 16px;
      border-radius: 4px;
      cursor: pointer;
      background-color: #1890ff;
      color: white;
      border: none;
      font-size: 14px;
    }
    
    /* 股票代码帮助样式 */
    .stock-code-help {
      margin-top: 15px;
      padding: 10px;
      background-color: #f8f9fa;
      border-radius: 4px;
      border-left: 3px solid #1890ff;
    }
    
    .stock-code-help h4 {
      font-size: 14px;
      margin-top: 0;
      margin-bottom: 8px;
      color: #333;
    }
    
    .stock-code-help ul {
      margin: 0;
      padding-left: 20px;
      font-size: 13px;
      color: #555;
    }
    
    .stock-code-help li {
      margin-bottom: 4px;
      line-height: 1.4;
    }
    
    .help-tip {
      font-size: 12px;
      color: #666;
      font-style: italic;
      margin-top: 8px;
      margin-bottom: 0;
    }
  </style>
</head>
<body>
  <div id="app"></div>
  
  <!-- API密钥设置对话框 -->
  <div id="api-key-dialog">
    <div class="api-dialog-content">
      <div class="api-dialog-title">设置API密钥</div>
      <div class="api-dialog-body">
        <p>要获取实时股票数据，您需要设置一个Alpha Vantage API密钥。</p>
        <p>您可以在 <a href="https://www.alphavantage.co/support/#api-key" target="_blank">Alpha Vantage官网</a> 免费获取API密钥。</p>
        <label for="api-key-input">API密钥:</label>
        <input type="text" id="api-key-input" placeholder="请输入您的Alpha Vantage API密钥" />
        
        <div class="stock-code-help">
          <h4>股票代码示例：</h4>
          <ul>
            <li><strong>美股:</strong> AAPL (苹果), MSFT (微软), GOOGL (谷歌), AMZN (亚马逊), TSLA (特斯拉)</li>
            <li><strong>港股:</strong> 00700.HK (腾讯), 09988.HK (阿里巴巴), 03690.HK (美团)</li>
            <li><strong>A股:</strong> 600519.SH (贵州茅台), 000858.SZ (五粮液), 300750.SZ (宁德时代)</li>
          </ul>
          <p class="help-tip">提示: 在自选股添加框中可直接输入以上代码添加股票，如"AAPL"、"00700"或"600519"。</p>
        </div>
      </div>
      <div class="api-dialog-footer">
        <button onclick="saveApiKey()">保存</button>
      </div>
    </div>
  </div>

  <!-- 使用全局版本的Vue和Vue Router -->
  <script src="https://unpkg.com/vue@3.2.31/dist/vue.global.js"></script>
  <script src="https://unpkg.com/vue-router@4.0.14/dist/vue-router.global.js"></script>
  
  <!-- 应用代码 -->
  <script>
    // 存储API密钥
    let apiKey = localStorage.getItem('alphavantage_api_key') || 'YOUR_API_KEY_HERE';
    
    // 全局函数用于更新API密钥
    window.updateApiKey = function(newApiKey) {
      apiKey = newApiKey;
      console.log('API密钥已更新');
    };
    
    // 股票API服务
    const StockApi = {
      getDailyStockData: async function(symbol, outputSize = 'compact') {
        try {
          // 检查API密钥
          if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
            throw new Error('未设置API密钥');
          }
          
          const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${symbol}&outputsize=${outputSize}&apikey=${apiKey}`);
          const data = await response.json();
          
          if (data['Error Message']) {
            throw new Error(data['Error Message']);
          }
          
          if (data['Note']) {
            console.warn('API使用频率限制提醒:', data['Note']);
          }
          
          const timeSeriesData = data['Time Series (Daily)'];
          if (!timeSeriesData) {
            throw new Error('无法获取股票数据');
          }
          
          return this.formatStockData(timeSeriesData);
        } catch (error) {
          console.error('获取股票数据失败:', error);
          throw error;
        }
      },
      
      getQuote: async function(symbol) {
        try {
          // 检查API密钥
          if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
            throw new Error('未设置API密钥');
          }
          
          const response = await fetch(`https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=${apiKey}`);
          const data = await response.json();
          
          if (data['Error Message']) {
            throw new Error(data['Error Message']);
          }
          
          const quote = data['Global Quote'];
          if (!quote) {
            throw new Error('无法获取实时报价');
          }
          
          return {
            symbol: quote['01. symbol'] || symbol,
            price: parseFloat(quote['05. price']) || 0,
            change: parseFloat(quote['09. change']) || 0,
            changePercent: parseFloat(quote['10. change percent'].replace('%', '')) || 0,
            open: parseFloat(quote['02. open']) || 0,
            high: parseFloat(quote['03. high']) || 0,
            low: parseFloat(quote['04. low']) || 0,
            close: parseFloat(quote['08. previous close']) || 0,
            volume: quote['06. volume'] || '0',
          };
        } catch (error) {
          console.error('获取实时报价失败:', error);
          return {
            symbol: symbol,
            price: 0,
            change: 0,
            changePercent: 0,
            open: 0, high: 0, low: 0, close: 0,
            volume: '0'
          };
        }
      },
      
      searchStocks: async function(keywords) {
        try {
          // 检查API密钥
          if (!apiKey || apiKey === 'YOUR_API_KEY_HERE') {
            throw new Error('未设置API密钥');
          }
          
          const response = await fetch(`https://www.alphavantage.co/query?function=SYMBOL_SEARCH&keywords=${keywords}&apikey=${apiKey}`);
          const data = await response.json();
          
          if (data['Error Message']) {
            throw new Error(data['Error Message']);
          }
          
          return data.bestMatches ? data.bestMatches.map(stock => ({
            symbol: stock['1. symbol'],
            name: stock['2. name'],
            type: stock['3. type'],
            region: stock['4. region'],
            currency: stock['8. currency']
          })) : [];
        } catch (error) {
          console.error('搜索股票失败:', error);
          return [];
        }
      },
      
      getMarketIndices: async function() {
        // Alpha Vantage免费版对股指数据有限制，这里使用模拟数据
        return [
          { name: '上证指数', symbol: '000001.SS', value: 3000 + Math.random() * 500, change: (Math.random() * 4 - 2) },
          { name: '深证成指', symbol: '399001.SZ', value: 10000 + Math.random() * 2500, change: (Math.random() * 4 - 2) },
          { name: '创业板指', symbol: '399006.SZ', value: 2200 + Math.random() * 500, change: (Math.random() * 4 - 2) },
        ];
      },
      
      getHotStocks: async function(limit = 10) {
        // 热门股票列表
        const popularSymbols = [
          // 美股科技股
          'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA', 'META', 'NVDA', 'NFLX', 'INTC', 'AMD',
          // 中国科技股
          'BABA', 'PDD', 'BIDU', 'JD', 'NTES', 'TCOM', 'TME', 'IQ', 'BILI', 'NIO',
          // 中国港股
          '00700.HK', '09988.HK', '03690.HK', '09999.HK', '01810.HK', '02269.HK', '02020.HK',
          // 中国A股
          '600519.SH', '601398.SH', '600036.SH', '601318.SH', '600276.SH', 
          '000858.SZ', '300750.SZ', '002594.SZ', '000333.SZ', '002415.SZ'
        ];
        
        const result = [];
        
        for (let i = 0; i < Math.min(limit, popularSymbols.length); i++) {
          try {
            const quote = await this.getQuote(popularSymbols[i]);
            result.push(quote);
          } catch (error) {
            console.warn(`获取${popularSymbols[i]}数据失败:`, error);
          }
        }
        
        return result;
      },
      
      formatStockData: function(timeSeriesData) {
        return Object.entries(timeSeriesData).map(([date, values]) => ({
          date,
          open: parseFloat(values['1. open']),
          high: parseFloat(values['2. high']),
          low: parseFloat(values['3. low']),
          close: parseFloat(values['4. close']),
          volume: parseInt(values['5. volume'])
        })).sort((a, b) => new Date(a.date) - new Date(b.date));
      }
    };
    
    // 股票图表组件
    const StockChart = {
      props: {
        symbol: { type: String, default: '' },
        timeRange: { type: String, default: '1m' },
        predictionData: { type: Array, default: () => [] },
        showPrediction: { type: Boolean, default: false }
      },
      template: `
        <div class="stock-chart">
          <div ref="chartContainer" class="chart-container"></div>
          <div v-if="loading" class="loading-overlay">
            <div class="spinner"></div>
            <div class="loading-text">加载数据中...</div>
          </div>
        </div>
      `,
      data() {
        return {
          loading: true,
          chartInstance: null,
          stockData: []
        };
      },
      mounted() {
        this.initChart();
        if (this.symbol) {
          this.fetchData();
        }
      },
      watch: {
        symbol(newSymbol) { 
          if (newSymbol) {
            this.fetchData(); 
          }
        },
        timeRange() { 
          if (this.symbol) {
            this.fetchData(); 
          }
        },
        predictionData: {
          handler(newData) {
            if (newData && newData.length > 0) {
              this.updatePredictionData();
            }
          },
          deep: true
        }
      },
      methods: {
        initChart() {
          console.log('初始化图表');
          
          setTimeout(() => {
            this.loading = false;
            
            const chartElement = document.createElement('div');
            chartElement.className = 'mock-chart';
            chartElement.innerHTML = '<div class="chart-placeholder">股票图表区域 - ' + (this.symbol || '未选择股票') + '</div>';
            
            const container = this.$refs.chartContainer;
            if (container) {
              container.innerHTML = '';
              container.appendChild(chartElement);
            }
          }, 1000);
        },
        async fetchData() {
          if (!this.symbol) return;
          
          this.loading = true;
          
          try {
            console.log('获取股票数据:', this.symbol, this.timeRange);
            
            // 根据时间范围确定请求参数
            const outputSize = this.getTimeRangeSize();
            
            // 获取真实股票数据
            const data = await StockApi.getDailyStockData(this.symbol, outputSize);
            
            // 过滤数据，仅保留指定时间范围内的数据
            this.stockData = this.filterDataByTimeRange(data);
            
            this.updateChart();
          } catch (error) {
            console.error('获取股票数据失败:', error);
            // 如果API请求失败，使用模拟数据
            this.stockData = this.generateMockData();
            this.updateChart();
          } finally {
            this.loading = false;
          }
        },
        
        getTimeRangeSize() {
          // 根据时间范围确定请求数据量
          if (this.timeRange === '1d' || this.timeRange === '1w' || this.timeRange === '1m') {
            return 'compact'; // 近100天数据
          } else {
            return 'full'; // 完整数据，最多20年
          }
        },
        
        filterDataByTimeRange(data) {
          if (!data || !data.length) return [];
          
          const now = new Date();
          let daysAgo = 30; // 默认一个月
          
          if (this.timeRange === '1d') daysAgo = 1;
          if (this.timeRange === '1w') daysAgo = 7;
          if (this.timeRange === '3m') daysAgo = 90;
          if (this.timeRange === '1y') daysAgo = 365;
          if (this.timeRange === '5y') daysAgo = 365 * 5;
          
          const cutoffDate = new Date(now);
          cutoffDate.setDate(cutoffDate.getDate() - daysAgo);
          
          return data.filter(item => new Date(item.date) >= cutoffDate);
        },
        updateChart() {
          console.log('更新图表数据:', this.stockData.length + '个数据点');
          
          // 简单显示最新数据
          const container = this.$refs.chartContainer;
          if (container) {
            // 清空容器
            container.innerHTML = '';
            
            // 创建一个模拟的图表元素
            const chartElement = document.createElement('div');
            chartElement.className = 'mock-chart';
            
            // 创建一个简单的表格显示数据
            let content = `<div class="chart-title">${this.symbol} 股价数据</div>`;
            
            if (this.stockData.length > 0) {
              // 显示最新价格
              const latestData = this.stockData[this.stockData.length - 1];
              content += `<div class="latest-price">最新价: ¥${latestData.close.toFixed(2)}</div>`;
              
              // 创建简单的线图
              content += `<div class="simple-chart">`;
              // 这里创建一个非常简单的图表展示，实际应用中应该使用专业的图表库
              content += `<svg width="100%" height="200" style="background-color: #f9f9f9;">`;
              
              // 获取最高和最低价格，用于计算比例
              const prices = this.stockData.map(d => d.close);
              const minPrice = Math.min(...prices);
              const maxPrice = Math.max(...prices);
              const range = maxPrice - minPrice || 1; // 防止除以零
              
              // 绘制折线
              let path = '';
              this.stockData.forEach((dataPoint, index) => {
                const x = (index / (this.stockData.length - 1)) * 100;
                const y = 100 - ((dataPoint.close - minPrice) / range) * 80; // 80% 的高度用于图表
                
                if (index === 0) {
                  path += `M${x},${y}`;
                } else {
                  path += ` L${x},${y}`;
                }
              });
              
              content += `<path d="${path}" stroke="${latestData.close > this.stockData[0].close ? '#00C853' : '#FF5252'}" stroke-width="2" fill="none" />`;
              content += `</svg>`;
              content += `</div>`;
              
              // 添加数据表格
              content += `<table class="data-preview">`;
              content += `<tr><th>日期</th><th>开盘</th><th>最高</th><th>最低</th><th>收盘</th><th>成交量</th></tr>`;
              
              // 显示最新的5个数据点
              const recentData = this.stockData.slice(-5).reverse();
              recentData.forEach(dataPoint => {
                content += `<tr>
                  <td>${dataPoint.date}</td>
                  <td>${dataPoint.open.toFixed(2)}</td>
                  <td>${dataPoint.high.toFixed(2)}</td>
                  <td>${dataPoint.low.toFixed(2)}</td>
                  <td>${dataPoint.close.toFixed(2)}</td>
                  <td>${this.formatVolume(dataPoint.volume)}</td>
                </tr>`;
              });
              
              content += `</table>`;
            } else {
              content += `<div class="no-data">暂无数据</div>`;
            }
            
            chartElement.innerHTML = content;
            container.appendChild(chartElement);
          }
          
          if (this.showPrediction && this.predictionData.length > 0) {
            this.updatePredictionData();
          }
        },
        
        formatVolume(volume) {
          // 格式化成交量
          const num = parseInt(volume);
          if (isNaN(num)) return volume;
          
          if (num >= 1000000000) {
            return (num / 1000000000).toFixed(2) + 'B';
          } else if (num >= 1000000) {
            return (num / 1000000).toFixed(2) + 'M';
          } else if (num >= 1000) {
            return (num / 1000).toFixed(2) + 'K';
          }
          
          return num.toString();
        },
        updatePredictionData() {
          if (!this.showPrediction || !this.predictionData.length) return;
          
          console.log('添加预测数据到图表:', this.predictionData.length + '个数据点');
          
          const container = this.$refs.chartContainer;
          if (container) {
            const predictionElement = document.createElement('div');
            predictionElement.className = 'prediction-indicator';
            predictionElement.innerHTML = '<div class="prediction-label">包含预测数据</div>';
            
            if (!container.querySelector('.prediction-indicator')) {
              container.appendChild(predictionElement);
            }
          }
        },
        generateMockData() {
          const data = [];
          const now = new Date();
          let days = 30;
          
          if (this.timeRange === '1d') days = 1;
          if (this.timeRange === '1w') days = 7;
          if (this.timeRange === '3m') days = 90;
          if (this.timeRange === '1y') days = 365;
          if (this.timeRange === '5y') days = 365 * 5;
          
          let price = 100;
          
          for (let i = days; i >= 0; i--) {
            const date = new Date(now);
            date.setDate(date.getDate() - i);
            
            const change = (Math.random() * 2 - 1) * 2;
            price = price * (1 + change / 100);
            
            const dayData = {
              date: date.toISOString().split('T')[0],
              open: price * (1 - Math.random() * 0.01),
              high: price * (1 + Math.random() * 0.01),
              low: price * (1 - Math.random() * 0.01),
              close: price,
              volume: Math.floor(Math.random() * 10000000)
            };
            
            data.push(dayData);
          }
          
          return data;
        }
      }
    };
    
    // 市场概览组件
    const MarketOverview = {
      template: `
        <div class="market-overview">
          <div class="market-filter">
            <select v-model="selectedMarket" class="market-selector" @change="filterMarket">
              <option value="all">全部市场</option>
              <option value="sh">上证</option>
              <option value="sz">深证</option>
              <option value="hk">港股</option>
              <option value="us">美股</option>
            </select>
            
            <div class="market-tabs">
              <div 
                v-for="tab in tabs" 
                :key="tab.key"
                :class="['tab-item', { active: activeTab === tab.key }]" 
                @click="activeTab = tab.key"
              >
                {{ tab.name }}
              </div>
            </div>
          </div>
          
          <div class="stock-list">
            <table class="table">
              <thead>
                <tr>
                  <th>名称</th>
                  <th>最新价</th>
                  <th>涨跌幅</th>
                  <th>成交量</th>
                  <th>操作</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(stock, index) in filteredStocks" :key="index">
                  <td class="stock-name">
                    <div class="name">{{ stock.name }}</div>
                    <div class="code">{{ stock.symbol }}</div>
                  </td>
                  <td class="stock-price">{{ stock.price }}</td>
                  <td :class="['change', stock.change > 0 ? 'up' : 'down']">
                    {{ stock.change > 0 ? '+' : '' }}{{ stock.change }}%
                  </td>
                  <td>{{ stock.volume }}</td>
                  <td class="actions">
                    <button class="action-button" @click="viewStock(stock)">
                      <i class="fas fa-chart-line"></i>
                    </button>
                    <button class="action-button" @click="addToWatchlist(stock)">
                      <i class="fas fa-star"></i>
                    </button>
                    <button class="action-button" @click="runPrediction(stock)">
                      <i class="fas fa-magic"></i>
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      `,
      data() {
        return {
          selectedMarket: 'all',
          activeTab: 'hot',
          tabs: [
            { key: 'hot', name: '热门' },
            { key: 'gainers', name: '涨幅榜' },
            { key: 'losers', name: '跌幅榜' },
            { key: 'turnover', name: '换手率' },
          ],
          stocks: [
            {
              name: '阿里巴巴',
              symbol: '09988.HK',
              price: 82.15,
              change: 1.25,
              volume: '11.2M',
              market: 'hk',
              category: ['hot', 'gainers']
            },
            {
              name: '腾讯控股',
              symbol: '00700.HK',
              price: 320.80,
              change: -0.58,
              volume: '9.8M',
              market: 'hk',
              category: ['hot']
            },
            {
              name: '贵州茅台',
              symbol: '600519.SH',
              price: 1689.50,
              change: 2.03,
              volume: '2.1M',
              market: 'sh',
              category: ['hot', 'gainers']
            },
            {
              name: '宁德时代',
              symbol: '300750.SZ',
              price: 214.32,
              change: 3.65,
              volume: '8.5M',
              market: 'sz',
              category: ['hot', 'gainers', 'turnover']
            }
          ]
        };
      },
      computed: {
        filteredStocks() {
          return this.stocks.filter(stock => {
            const marketFilter = this.selectedMarket === 'all' || stock.market === this.selectedMarket;
            const categoryFilter = stock.category.includes(this.activeTab);
            return marketFilter && categoryFilter;
          });
        }
      },
      methods: {
        filterMarket() {
          console.log('切换市场到:', this.selectedMarket);
        },
        viewStock(stock) {
          this.$router.push(`/stock/${stock.symbol}`);
        },
        addToWatchlist(stock) {
          console.log('添加到自选:', stock.name);
          alert(`已将 ${stock.name} 添加到自选`);
        },
        runPrediction(stock) {
          this.$router.push({
            path: '/prediction',
            query: { stockSymbol: stock.symbol }
          });
        }
      }
    };
    
    // 自选股组件
    const WatchList = {
      template: `
        <div class="watchlist">
          <div v-if="watchlist.length === 0" class="empty-watchlist">
            <i class="fas fa-star empty-icon"></i>
            <p>暂无自选股票</p>
            <p class="hint">可在股票详情页添加股票到自选</p>
          </div>
          
          <div v-else>
            <div class="watchlist-header">
              <span>我的自选 ({{ watchlist.length }})</span>
              <div class="header-actions">
                <button class="action-button" @click="refreshAll">
                  <i class="fas fa-sync-alt"></i>
                </button>
                <button class="action-button" @click="showEditMode = !showEditMode">
                  <i class="fas fa-pencil-alt"></i>
                </button>
              </div>
            </div>
            
            <div class="watchlist-items">
              <div 
                v-for="(stock, index) in watchlist" 
                :key="stock.symbol"
                class="watchlist-item"
              >
                <div class="item-main" @click="viewStock(stock)">
                  <div class="stock-info">
                    <div class="stock-name">{{ stock.name }}</div>
                    <div class="stock-symbol">{{ stock.symbol }}</div>
                  </div>
                  
                  <div class="stock-price-info">
                    <div class="current-price">{{ stock.price }}</div>
                    <div :class="['change', stock.change > 0 ? 'up' : 'down']">
                      {{ stock.change > 0 ? '+' : '' }}{{ stock.change }}%
                    </div>
                  </div>
                </div>
                
                <div class="item-actions">
                  <button class="action-button" @click="runPrediction(stock)">
                    <i class="fas fa-magic"></i>
                  </button>
                  <button v-if="showEditMode" class="action-button remove" @click="removeFromWatchlist(index)">
                    <i class="fas fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>
          
          <div class="add-stock-form" v-if="!showEditMode">
            <input 
              type="text" 
              v-model="newStockSymbol" 
              class="form-input"
              placeholder="输入股票代码添加到自选"
              @keyup.enter="addStockBySymbol"
            />
            <button class="button" @click="addStockBySymbol">
              <i class="fas fa-plus"></i> 添加
            </button>
          </div>
        </div>
      `,
      data() {
        return {
          watchlist: [
            {
              name: '阿里巴巴',
              symbol: '09988.HK',
              price: 82.15,
              change: 1.25
            },
            {
              name: '贵州茅台',
              symbol: '600519.SH',
              price: 1689.50,
              change: 2.03
            }
          ],
          showEditMode: false,
          newStockSymbol: '',
          refreshing: false
        };
      },
      methods: {
        viewStock(stock) {
          this.$router.push(`/stock/${stock.symbol}`);
        },
        removeFromWatchlist(index) {
          if (confirm(`确定要从自选股中移除 ${this.watchlist[index].name} 吗？`)) {
            this.watchlist.splice(index, 1);
          }
        },
        runPrediction(stock) {
          this.$router.push({
            path: '/prediction',
            query: { stockSymbol: stock.symbol }
          });
        },
        refreshAll() {
          this.refreshing = true;
          
          setTimeout(() => {
            this.watchlist.forEach(stock => {
              const change = (Math.random() * 2 - 1) * 0.5;
              stock.change = parseFloat((stock.change + change).toFixed(2));
              stock.price = parseFloat((stock.price * (1 + change / 100)).toFixed(2));
            });
            
            this.refreshing = false;
          }, 1000);
        },
        addStockBySymbol() {
          if (!this.newStockSymbol) return;
          
          const exists = this.watchlist.some(stock => 
            stock.symbol.toLowerCase() === this.newStockSymbol.toLowerCase());
          
          if (exists) {
            alert('该股票已在自选列表中');
            return;
          }
          
          const mockStocks = {
            // A股示例
            '600519': { name: '贵州茅台', symbol: '600519.SH', price: 1689.50, change: 2.03 },
            '601398': { name: '工商银行', symbol: '601398.SH', price: 5.28, change: 0.57 },
            '000858': { name: '五粮液', symbol: '000858.SZ', price: 168.75, change: 1.35 },
            '000001': { name: '平安银行', symbol: '000001.SZ', price: 12.85, change: -0.32 },
            '300750': { name: '宁德时代', symbol: '300750.SZ', price: 214.32, change: 3.65 },
            '002594': { name: '比亚迪', symbol: '002594.SZ', price: 228.50, change: 2.78 },
            
            // 港股示例
            '00700': { name: '腾讯控股', symbol: '00700.HK', price: 320.80, change: -0.58 },
            '09988': { name: '阿里巴巴', symbol: '09988.HK', price: 82.15, change: 1.25 },
            '03690': { name: '美团', symbol: '03690.HK', price: 112.10, change: -1.22 },
            '09999': { name: '网易', symbol: '09999.HK', price: 145.30, change: 0.86 },
            
            // 美股示例
            'AAPL': { name: '苹果公司', symbol: 'AAPL', price: 175.40, change: 1.82 },
            'MSFT': { name: '微软', symbol: 'MSFT', price: 335.75, change: 0.95 },
            'TSLA': { name: '特斯拉', symbol: 'TSLA', price: 242.60, change: -2.15 },
            'BABA': { name: '阿里巴巴', symbol: 'BABA', price: 82.15, change: 1.25 }
          };
          
          const foundStock = mockStocks[this.newStockSymbol];
          
          if (foundStock) {
            this.watchlist.push(foundStock);
            this.newStockSymbol = '';
          } else {
            alert('未找到该股票，请检查代码是否正确');
          }
        }
      }
    };
    
    // Dashboard页面
    const Dashboard = {
      components: {
        StockChart,
        MarketOverview,
        WatchList
      },
      template: `
        <div class="dashboard-container">
          <h2 class="page-title">市场概览</h2>
          
          <div class="market-summary">
            <div class="card">
              <h3>市场指数</h3>
              <div class="index-list">
                <div class="index-item up">
                  <span class="index-name">上证指数</span>
                  <span class="index-value">3,250.55</span>
                  <span class="index-change">+1.2%</span>
                </div>
                <div class="index-item down">
                  <span class="index-name">深证成指</span>
                  <span class="index-value">12,120.32</span>
                  <span class="index-change">-0.5%</span>
                </div>
                <div class="index-item up">
                  <span class="index-name">创业板指</span>
                  <span class="index-value">2,589.77</span>
                  <span class="index-change">+0.8%</span>
                </div>
              </div>
            </div>
          </div>
          
          <div class="row">
            <div class="column">
              <div class="card">
                <h3>热门股票</h3>
                <market-overview></market-overview>
              </div>
            </div>
            <div class="column">
              <div class="card">
                <h3>我的自选</h3>
                <watch-list></watch-list>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h3>预测模型表现</h3>
            <div class="model-performance">
              <div class="model-item">
                <h4>LSTM模型</h4>
                <div class="performance-stats">
                  <div class="stat">
                    <span class="stat-label">准确率</span>
                    <span class="stat-value">78.5%</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">误差率</span>
                    <span class="stat-value">3.2%</span>
                  </div>
                </div>
              </div>
              <div class="model-item">
                <h4>ARIMA模型</h4>
                <div class="performance-stats">
                  <div class="stat">
                    <span class="stat-label">准确率</span>
                    <span class="stat-value">72.1%</span>
                  </div>
                  <div class="stat">
                    <span class="stat-label">误差率</span>
                    <span class="stat-value">4.5%</span>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="card">
            <h3>最近预测</h3>
            <stock-chart></stock-chart>
          </div>
        </div>
      `,
      mounted() {
        console.log('仪表盘组件已加载');
      }
    };
    
    // 股票详情页面
    const StockDetails = {
      components: {
        StockChart
      },
      template: `
        <div class="stock-details">
          <div class="stock-header">
            <h2>{{ stockInfo.name }} ({{ stockInfo.symbol }})</h2>
            <div class="stock-price" :class="priceChangeClass">
              <span class="current-price">¥{{ stockInfo.price }}</span>
              <span class="change">{{ stockInfo.change > 0 ? '+' : '' }}{{ stockInfo.change }}%</span>
            </div>
            <button class="button" @click="addToWatchlist">
              <i class="fas fa-star"></i> 添加到自选
            </button>
          </div>
          
          <div class="row">
            <div class="column">
              <div class="card">
                <h3>股票信息</h3>
                <table class="stock-info-table">
                  <tr>
                    <td>开盘价</td>
                    <td>¥{{ stockInfo.open }}</td>
                    <td>收盘价</td>
                    <td>¥{{ stockInfo.close }}</td>
                  </tr>
                  <tr>
                    <td>最高价</td>
                    <td>¥{{ stockInfo.high }}</td>
                    <td>最低价</td>
                    <td>¥{{ stockInfo.low }}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
          
          <div class="card">
            <div class="chart-controls">
              <h3>价格走势</h3>
              <div class="time-filters">
                <button @click="changeTimeRange('1d')" :class="{ active: timeRange === '1d' }">1天</button>
                <button @click="changeTimeRange('1w')" :class="{ active: timeRange === '1w' }">1周</button>
                <button @click="changeTimeRange('1m')" :class="{ active: timeRange === '1m' }">1月</button>
                <button @click="changeTimeRange('3m')" :class="{ active: timeRange === '3m' }">3月</button>
                <button @click="changeTimeRange('1y')" :class="{ active: timeRange === '1y' }">1年</button>
              </div>
            </div>
            <stock-chart :symbol="$route.params.symbol" :time-range="timeRange"></stock-chart>
          </div>
        </div>
      `,
      data() {
        return {
          timeRange: '1m',
          stockInfo: {
            name: '阿里巴巴',
            symbol: '09988.HK',
            price: 82.15,
            change: 1.25,
            open: 81.20,
            close: 82.15,
            high: 82.60,
            low: 80.95
          }
        };
      },
      computed: {
        priceChangeClass() {
          return this.stockInfo.change > 0 ? 'up' : 'down';
        }
      },
      mounted() {
        this.fetchStockData();
      },
      methods: {
        fetchStockData() {
          console.log('获取股票数据:', this.$route.params.symbol);
        },
        changeTimeRange(range) {
          this.timeRange = range;
        },
        addToWatchlist() {
          alert(`已将 ${this.stockInfo.name} 添加到自选`);
        }
      }
    };
    
    // 预测页面
    const Prediction = {
      components: {
        StockChart
      },
      template: `
        <div class="prediction-page">
          <h2 class="page-title">股票预测</h2>
          
          <div class="card">
            <h3>选择股票和预测参数</h3>
            <div class="form-container">
              <div class="form-group">
                <label class="form-label">股票代码</label>
                <div class="stock-search">
                  <input type="text" v-model="stockSymbol" class="form-input" placeholder="输入股票代码或名称" />
                  <button class="button" @click="searchStock">
                    <i class="fas fa-search"></i> 搜索
                  </button>
                </div>
                <div v-if="stockInfo.name" class="selected-stock">
                  <div class="stock-info">
                    <span class="stock-name">{{ stockInfo.name }}</span>
                    <span class="stock-symbol">{{ stockInfo.symbol }}</span>
                  </div>
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label class="form-label">预测模型</label>
                  <select v-model="predictionModel" class="form-input">
                    <option value="lstm">LSTM深度学习</option>
                    <option value="arima">ARIMA时间序列</option>
                    <option value="prophet">Prophet预测</option>
                  </select>
                </div>
                
                <div class="form-group">
                  <label class="form-label">预测时长</label>
                  <select v-model="predictionDuration" class="form-input">
                    <option value="1w">1周</option>
                    <option value="2w">2周</option>
                    <option value="1m">1个月</option>
                  </select>
                </div>
              </div>
              
              <div class="prediction-actions">
                <button class="button" @click="runPrediction" :disabled="!stockSymbol">
                  <i class="fas fa-play"></i> 开始预测
                </button>
                <button class="button button-secondary" @click="resetSettings">
                  <i class="fas fa-redo"></i> 重置
                </button>
              </div>
            </div>
          </div>
        </div>
      `,
      data() {
        return {
          stockSymbol: '',
          stockInfo: {
            name: '',
            symbol: ''
          },
          predictionModel: 'lstm',
          predictionDuration: '1m'
        };
      },
      methods: {
        searchStock() {
          if (!this.stockSymbol) return;
          
          this.stockInfo = {
            name: '阿里巴巴',
            symbol: '09988.HK'
          };
        },
        runPrediction() {
          alert('预测功能已触发，实际应用中会调用预测API');
        },
        resetSettings() {
          this.predictionModel = 'lstm';
          this.predictionDuration = '1m';
        }
      }
    };
    
    // 历史记录页面
    const History = {
      template: `
        <div class="history-page">
          <h2 class="page-title">预测历史记录</h2>
          
          <div class="card">
            <div class="filter-controls">
              <div class="search-bar">
                <input type="text" v-model="searchQuery" class="form-input" placeholder="搜索股票代码或名称" />
                <button class="button" @click="search">
                  <i class="fas fa-search"></i> 搜索
                </button>
              </div>
            </div>
            
            <div class="history-list">
              <table class="table">
                <thead>
                  <tr>
                    <th>日期</th>
                    <th>股票</th>
                    <th>预测模型</th>
                    <th>准确率</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody>
                  <tr v-for="(record, index) in records" :key="index">
                    <td>{{ record.date }}</td>
                    <td>{{ record.stockName }} ({{ record.stockSymbol }})</td>
                    <td>{{ record.model }}</td>
                    <td>{{ record.accuracy }}%</td>
                    <td class="actions">
                      <button class="action-button" @click="viewDetails(record)">
                        <i class="fas fa-eye"></i>
                      </button>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      `,
      data() {
        return {
          searchQuery: '',
          records: [
            {
              date: '2023-05-01',
              stockName: '阿里巴巴',
              stockSymbol: '09988.HK',
              model: 'LSTM',
              accuracy: 85
            },
            {
              date: '2023-04-28',
              stockName: '腾讯控股',
              stockSymbol: '00700.HK',
              model: 'ARIMA',
              accuracy: 78
            }
          ]
        };
      },
      methods: {
        search() {
          console.log('搜索:', this.searchQuery);
        },
        viewDetails(record) {
          alert(`查看 ${record.stockName} 的预测详情`);
        }
      }
    };
    
    // 设置页面
    const Settings = {
      template: `
        <div class="settings-page">
          <h2 class="page-title">系统设置</h2>
          
          <div class="card">
            <h3>用户偏好</h3>
            
            <div class="settings-section">
              <div class="form-group">
                <label class="form-label">默认预测模型</label>
                <select v-model="settings.defaultModel" class="form-input">
                  <option value="lstm">LSTM深度学习</option>
                  <option value="arima">ARIMA时间序列</option>
                  <option value="prophet">Prophet预测</option>
                </select>
              </div>
              
              <div class="form-group">
                <label class="form-label">默认预测周期</label>
                <select v-model="settings.defaultDuration" class="form-input">
                  <option value="1w">1周</option>
                  <option value="2w">2周</option>
                  <option value="1m">1个月</option>
                </select>
              </div>
            </div>
          </div>
          
          <div class="action-buttons">
            <button class="button" @click="saveSettings">
              <i class="fas fa-save"></i> 保存设置
            </button>
          </div>
        </div>
      `,
      data() {
        return {
          settings: {
            defaultModel: 'lstm',
            defaultDuration: '1m',
          }
        };
      },
      methods: {
        saveSettings() {
          alert('设置已保存');
        }
      }
    };
    
    // 主应用组件
    const App = {
      template: `
        <div class="app-container">
          <header class="header">
            <div class="logo">
              <h1>股票预测分析平台</h1>
            </div>
            <div class="header-right">
              <button class="button" @click="toggleSidebar">
                <i class="fas fa-bars"></i>
              </button>
              <span class="user-info">
                <i class="fas fa-user-circle"></i> 用户名
              </span>
            </div>
          </header>
          
          <div class="sidebar" :class="{ open: sidebarOpen }">
            <nav class="nav-menu">
              <ul>
                <li>
                  <router-link to="/">
                    <i class="fas fa-tachometer-alt"></i> 仪表盘
                  </router-link>
                </li>
                <li>
                  <router-link to="/prediction">
                    <i class="fas fa-chart-line"></i> 股票预测
                  </router-link>
                </li>
                <li>
                  <router-link to="/history">
                    <i class="fas fa-history"></i> 历史记录
                  </router-link>
                </li>
                <li>
                  <router-link to="/settings">
                    <i class="fas fa-cog"></i> 设置
                  </router-link>
                </li>
              </ul>
            </nav>
          </div>
          
          <main class="main-content">
            <router-view></router-view>
          </main>
        </div>
      `,
      data() {
        return {
          sidebarOpen: true
        };
      },
      methods: {
        toggleSidebar() {
          this.sidebarOpen = !this.sidebarOpen;
        }
      }
    };
    
    // 定义路由
    const routes = [
      { path: '/', component: Dashboard },
      { path: '/stock/:symbol', component: StockDetails },
      { path: '/prediction', component: Prediction },
      { path: '/history', component: History },
      { path: '/settings', component: Settings }
    ];
    
    // 创建路由实例
    const router = VueRouter.createRouter({
      history: VueRouter.createWebHashHistory(),
      routes
    });
    
    // 创建Vue应用实例
    const app = Vue.createApp(App);
    
    // 使用路由
    app.use(router);
    
    // 挂载应用
    app.mount('#app');
  </script>
</body>
</html> 